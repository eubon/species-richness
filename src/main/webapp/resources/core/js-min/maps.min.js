function detailContent(e,t,a){var o=[];t.forEachLatLng(function(e){o.push(e)});var l='<div class="larger">'+e.label+"<strong>"+e.records+'</strong></div>\n                        <div class="smaller cell">\n                            <h5>Cell:</h5>\n                            <p>Bottom left: '+o[0].lat()+"째 "+o[0].lng()+"째<br/>\n                            Top right: "+o[2].lat()+"째 "+o[2].lng()+"째</p>\n                        </div>";"specieslist"in e&&(l+='<div class="smaller cell">\n                            <h5>Species List:</h5>',l+=speciesList(e.specieslist),l+="</div>"),a&&(l+='<div><a class="btn btn-default dismiss">Back to hover mode</a></div>',$("#details-info").on("click",".dismiss",function(e){detailLocked=!1,$("#details-info").html("")})),$("#details-info").html(l)}function createGeoJSONs(e){var t=[];return $.each(e,function(e,a){var o={type:"FeatureCollection",features:[]};$.each(a.cells,function(e,t){var a={type:"Feature",geometry:{type:"Polygon",coordinates:[[[t.bounds.bottomLeft.longitude,t.bounds.bottomLeft.latitude],[t.bounds.topRight.longitude,t.bounds.bottomLeft.latitude],[t.bounds.topRight.longitude,t.bounds.topRight.latitude],[t.bounds.bottomLeft.longitude,t.bounds.topRight.latitude],[t.bounds.bottomLeft.longitude,t.bounds.bottomLeft.latitude]]]},properties:{occurences:{records:t.numOccurences,label:"Occurences: "},species:{records:t.numSpecies,label:"Species: ",specieslist:t.species},ratio:{records:t.taxonRatio,label:"Ratio of selected species occurences to higher taxon occurences: "}}};o.features.push(a)}),t.push({year:a.year,collection:o})}),t}function showLayer(e,t,a,o,l,i){a.data.forEach(function(e){a.data.remove(e)}),a.data.addGeoJson(t[e].collection),a.data.setStyle(function(e){var t=e.getProperty(o).records,a=chooseValue(l.colours,t,l.allowZero);return 0===a&&(a="#777"),{fillOpacity:i,fillColor:a,strokeWeight:.5}}),a.data.addListener("mouseover",function(e){detailLocked||detailContent(e.feature.getProperty(o),e.feature.getGeometry(),!1)}),a.data.addListener("mouseout",function(e){detailLocked||$("#details-info").html("")}),a.data.addListener("click",function(e){detailLocked=!0,detailContent(e.feature.getProperty(o),e.feature.getGeometry(),detailLocked)})}function initPlayer(e,t,a,o,l){0!==e.length&&(showLayer(0,t,a,o,l[o],opacity),$("#player").player({keys:e,step:function(e){showLayer(e.position,t,a,o,l[o],opacity)}}))}function init(e,t,a){var o=new google.maps.Map($("#map").get(0),{zoom:3,center:{lat:t,lng:a},mapTypeId:google.maps.MapTypeId.TERRAIN}),l=e.layers,i=[];if(0!==l.length){$.each(l,function(e,t){i.push(t.year)});var s=createGeoJSONs(l);initPlayer(i,s,o,"occurences",views)}else $("#player").find("button").addClass("disabled"),$("#player").find("select").prop("disabled",!0),$("#details-info").html("No results found");$("#slider").slider({max:100,min:0,step:1,value:85,slide:function(e,t){opacity=t.value/100,$("#slider-value").text(t.value+" %"),o.data.forEach(function(e){o.data.overrideStyle(e,{fillOpacity:opacity})})}}),$("#view-tabs a").click(function(){var e=$(this).attr("href").replace("#","");initPlayer(i,s,o,e,views),detailLocked=!1,$("#details-info").html("")})}var views={occurences:{allowZero:!1,colours:[{key:100,value:"#f7ec75"},{key:500,value:"#f7da37"},{key:1e3,value:"#f7c775"},{key:3e3,value:"#f7b036"},{key:5e3,value:"#f79536"},{key:1e4,value:"#f76836"},{key:Number.MAX_VALUE,value:"#f73f36"}]},species:{allowZero:!1,colours:[{key:5,value:"#d9ed96"},{key:10,value:"#cce227"},{key:20,value:"#8cd701"},{key:40,value:"#5bbf21"},{key:80,value:"#339e36"},{key:100,value:"#007a3d"},{key:Number.MAX_VALUE,value:"#235033"}]},ratio:{allowZero:!1,colours:[{key:.1,value:"#d6e7e5"},{key:.2,value:"#bedad9"},{key:.3,value:"#a7d0ce"},{key:.4,value:"#8bc6cb"},{key:.5,value:"#68bcc8"},{key:.6,value:"#38b2c6"},{key:.7,value:"#00a9c3"},{key:.8,value:"#009fb8"},{key:.9,value:"#0097af"},{key:2,value:"#01899e"}]}},opacity=.85,detailLocked=!1;