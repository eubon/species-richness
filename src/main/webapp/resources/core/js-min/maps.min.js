function detailContent(a,b,c){var d=[];b.forEachLatLng(function(a){d.push(a)});var e='<div class="larger">'+a.label+"<strong>"+a.records+'</strong></div>\n<div class="smaller">\n<h5>Cell:</h5>\n<p>Bottom left: '+d[0].lat()+"째 "+d[0].lng()+"째<br/>\n                            Top right: "+d[2].lat()+"째 "+d[2].lng()+"째</p>\n</div>";"specieslist"in a&&(e+='<div class="smaller cell">\n<h5>Species List:</h5>',e+='<div id="species-list">'+speciesList(a.specieslist)+"</div>",e+="</div>"),c&&(e+='<div><a class="btn btn-default dismiss">Back to hover mode</a></div>',$("#details-info").on("click",".dismiss",function(a){detailLocked=!1,$("#details-info").html("")})),$("#details-info").html(e)}function createGeoJSONs(a){var b=[];return $.each(a,function(a,c){var d={type:"FeatureCollection",features:[]};$.each(c.cells,function(a,b){var c={type:"Feature",geometry:{type:"Polygon",coordinates:[[[b.bounds.bottomLeft.longitude,b.bounds.bottomLeft.latitude],[b.bounds.topRight.longitude,b.bounds.bottomLeft.latitude],[b.bounds.topRight.longitude,b.bounds.topRight.latitude],[b.bounds.bottomLeft.longitude,b.bounds.topRight.latitude],[b.bounds.bottomLeft.longitude,b.bounds.bottomLeft.latitude]]]},properties:{occurences:{records:b.numOccurences,label:"Occurences: "},species:{records:b.numSpecies,label:"Species: ",specieslist:b.species},ratio:{records:0===b.taxonRatio?0:b.taxonRatio.toFixed(3),label:"Ratio of selected species occurences to higher taxon occurences: "}}};d.features.push(c)}),b.push({year:c.year,collection:d})}),b}function showLayer(a,b,c,d,e,f){c.data.forEach(function(a){c.data.remove(a)}),c.data.addGeoJson(b[a].collection),c.data.setStyle(function(a){var b=a.getProperty(d).records,c=chooseValue(e.colours,b,e.allowZero);return 0===c&&(c="#777"),{fillOpacity:f,fillColor:c,strokeWeight:.5}}),c.data.addListener("mouseover",function(a){detailLocked||detailContent(a.feature.getProperty(d),a.feature.getGeometry(),!1)}),c.data.addListener("mouseout",function(a){detailLocked||$("#details-info").html("")}),c.data.addListener("click",function(a){detailLocked=!0,detailContent(a.feature.getProperty(d),a.feature.getGeometry(),detailLocked)})}function initPlayer(a,b,c,d,e){0!==a.length&&(showLayer(0,b,c,d,e[d],opacity),$("#player").player({keys:a,step:function(a){showLayer(a.position,b,c,d,e[d],opacity)}}))}function init(a,b,c){var d=new google.maps.Map($("#map").get(0),{zoom:3,center:{lat:b,lng:c},mapTypeId:google.maps.MapTypeId.TERRAIN}),e=a.layers,f=[];if(0!==e.length){$.each(e,function(a,b){f.push(b.year)});var g=createGeoJSONs(e);initPlayer(f,g,d,"occurences",views)}else $("#player").find("button").addClass("disabled"),$("#player").find("select").prop("disabled",!0),$("#details-info").html("No results found");$("#slider").slider({max:100,min:0,step:1,value:85,slide:function(a,b){opacity=b.value/100,$("#slider-value").text(b.value+" %"),d.data.forEach(function(a){d.data.overrideStyle(a,{fillOpacity:opacity})})}}),$("#view-tabs a").click(function(){var a=$(this).attr("href").replace("#","");initPlayer(f,g,d,a,views),detailLocked=!1,$("#details-info").html("")})}var views={occurences:{allowZero:!1,colours:[{key:100,value:"#f7ec75"},{key:500,value:"#f7da37"},{key:1e3,value:"#f7c775"},{key:3e3,value:"#f7b036"},{key:5e3,value:"#f79536"},{key:1e4,value:"#f76836"},{key:Number.MAX_VALUE,value:"#f73f36"}]},species:{allowZero:!1,colours:[{key:5,value:"#d9ed96"},{key:10,value:"#cce227"},{key:20,value:"#8cd701"},{key:40,value:"#5bbf21"},{key:80,value:"#339e36"},{key:100,value:"#007a3d"},{key:Number.MAX_VALUE,value:"#235033"}]},ratio:{allowZero:!1,colours:[{key:.1,value:"#d6e7e5"},{key:.2,value:"#bedad9"},{key:.3,value:"#a7d0ce"},{key:.4,value:"#8bc6cb"},{key:.5,value:"#68bcc8"},{key:.6,value:"#38b2c6"},{key:.7,value:"#00a9c3"},{key:.8,value:"#009fb8"},{key:.9,value:"#0097af"},{key:2,value:"#01899e"}]}},opacity=.85,detailLocked=!1;