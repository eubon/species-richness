function detailContent(e,t,a){var o=[];t.forEachLatLng(function(e){o.push(e)});var i='<div class="larger"><strong>'+e.records+"</strong> "+e.label+'</div><div class="smaller cell"><h5>Cell:</h5><p>Bottom left: '+o[0].lat()+"째 "+o[0].lng()+"째<br/>Top right: "+o[2].lat()+"째 "+o[2].lng()+"째</p></div>";a&&(i+='<div><a class="btn btn-default dismiss">Back to hover mode</a></div>',$("#details-info").on("click",".dismiss",function(e){detailLocked=!1,$("#details-info").html("")})),$("#details-info").html(i)}function createGeoJSONs(e){var t=[];return $.each(e,function(e,a){var o={type:"FeatureCollection",features:[]};$.each(a,function(e,t){var a={type:"Feature",geometry:{type:"Polygon",coordinates:[[[t.bottomLeft.longitude,t.bottomLeft.latitude],[t.topRight.longitude,t.bottomLeft.latitude],[t.topRight.longitude,t.topRight.latitude],[t.bottomLeft.longitude,t.topRight.latitude],[t.bottomLeft.longitude,t.bottomLeft.latitude]]]},properties:{occurences:{records:t.numOccurences,label:"occurences"},species:{records:t.numSpecies,label:"species"}}};o.features.push(a)}),t.push({year:e,collection:o})}),t}function showLayer(e,t,a,o,i,l){a.data.forEach(function(e){a.data.remove(e)}),a.data.addGeoJson(t[e].collection),a.data.setStyle(function(e){var t=e.getProperty(o).records,a=chooseValue(i,t);return{fillOpacity:l,fillColor:a,strokeWeight:.5}}),a.data.addListener("mouseover",function(e){detailLocked||detailContent(e.feature.getProperty(o),e.feature.getGeometry(),!1)}),a.data.addListener("mouseout",function(e){detailLocked||$("#details-info").html("")}),a.data.addListener("click",function(e){detailLocked=!0,detailContent(e.feature.getProperty(o),e.feature.getGeometry(),detailLocked)})}function initPlayer(e,t,a,o,i){showLayer(0,t,a,o,i[o],opacity),$("#player").player({keys:e,step:function(e){showLayer(e.position,t,a,o,i[o],opacity)}})}function init(e,t,a){var o=new google.maps.Map($("#map").get(0),{zoom:3,center:{lat:t,lng:a},mapTypeId:google.maps.MapTypeId.TERRAIN}),i=[];$.each(e,function(e,t){i.push(e)});var l=createGeoJSONs(e);initPlayer(i,l,o,"occurences",colours),$("#slider").slider({max:100,min:0,step:1,value:85,slide:function(e,t){opacity=t.value/100,$("#slider-value").text(t.value+" %"),o.data.forEach(function(e){o.data.overrideStyle(e,{fillOpacity:opacity})})}}),$("#view-tabs a").click(function(){var e=$(this).attr("href").replace("#","");initPlayer(i,l,o,e,colours),detailLocked=!1,$("#details-info").html("")})}var colours={occurences:[{key:100,value:"#f7ec75"},{key:500,value:"#f7da37"},{key:1e3,value:"#f7c775"},{key:3e3,value:"#f7b036"},{key:5e3,value:"#f79536"},{key:1e4,value:"#f76836"},{key:Number.MAX_VALUE,value:"#f73f36"}],species:[{key:5,value:"#d9ed96"},{key:10,value:"#cce227"},{key:20,value:"#8cd701"},{key:40,value:"#5bbf21"},{key:80,value:"#339e36"},{key:100,value:"#007a3d"},{key:Number.MAX_VALUE,value:"#235033"}]},opacity=.85,detailLocked=!1;